<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Puzzle Challenge - TravelVerse</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/style.css">
  <style>
    .board, .pieces {
      display: grid;
      grid-template-columns: repeat(3, 100px);
      grid-gap: 4px;
      margin: 20px auto;
      width: 320px;
    }
    .slot, .piece {
      width: 100px;
      height: 100px;
      border: 1px solid #ccc;
      background-size: 300px 300px;
    }
    #celebration {
      display: none;
      text-align: center;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div id="navbar-container"></div>

  <div class="container text-center mt-4">
    <h2>ðŸ§© Monument Puzzle Challenge</h2>
    <p>Rebuild the monument by dragging the pieces into the correct slots.</p>

    <!-- Puzzle Board -->
    <div id="puzzle-board" class="board"></div>

    <!-- Puzzle Pieces -->
    <div id="puzzle-pieces" class="pieces"></div>

    <!-- Celebration -->
    <div id="celebration">
      <h3 class="text-success">ðŸŽ‰ Puzzle Complete! You earned 100 points!</h3>
      <canvas id="confetti-canvas"></canvas>
    </div>
  </div>

  <div id="footer-container"></div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script src="assets/js/main.js"></script>

  <script>
    const image = "assets/images/taj-mahal.png"; // change to your monument image
    const board = document.getElementById("puzzle-board");
    const pieces = document.getElementById("puzzle-pieces");

    // Create board slots
    for (let i=0; i<9; i++) {
      let slot = document.createElement("div");
      slot.className = "slot";
      slot.dataset.index = i;
      board.appendChild(slot);
    }

    // Create shuffled pieces
    let indices = [...Array(9).keys()].sort(()=>Math.random()-0.5);
    indices.forEach((i) => {
      let piece = document.createElement("div");
      piece.className = "piece";
      piece.draggable = true;
      piece.style.backgroundImage = `url(${image})`;
      piece.style.backgroundPosition =
        `-${(i%3)*100}px -${Math.floor(i/3)*100}px`;
      piece.dataset.correct = i;
      pieces.appendChild(piece);
    });

    // Drag and drop
    document.querySelectorAll(".piece").forEach(p=>{
      p.addEventListener("dragstart", e=>{
        e.dataTransfer.setData("text", e.target.dataset.correct);
        e.dataTransfer.setData("bg", e.target.style.backgroundPosition);
      });
    });

    document.querySelectorAll(".slot").forEach(slot=>{
      slot.addEventListener("dragover", e=>e.preventDefault());
      slot.addEventListener("drop", e=>{
        e.preventDefault();
        const index = e.dataTransfer.getData("text");
        const bg = e.dataTransfer.getData("bg");
        slot.style.backgroundImage = `url(${image})`;
        slot.style.backgroundPosition = bg;
        slot.dataset.filled = index;
        checkWin();
      });
    });

    function checkWin(){
      const slots = document.querySelectorAll(".slot");
      if([...slots].every((s,i)=>s.dataset.filled == i)){
        document.getElementById("celebration").style.display = "block";
        startConfetti();
      }
    }

    function startConfetti(){
      const duration = 3 * 1000;
      const end = Date.now() + duration;
      (function frame() {
        confetti({ particleCount: 5, spread: 70, origin: { y: 0.6 } });
        if (Date.now() < end) requestAnimationFrame(frame);
      })();
    }
  </script>
</body>
</html>
